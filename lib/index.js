(()=>{"use strict";var e={827:function(e,r,t){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});const o=a(t(185));let n="mongodb+srv://username:<password>@cluster0.0rd6dy1.mongodb.net/";n=n.replace("username","dat97"),n=n.replace("<password>","v3AzRwH2YvtmVJxX"),o.default.set("strictQuery",!1),o.default.connect(n,{dbName:"Eshop-database"}).then((()=>{console.log("Connect to MongoDB")})).catch((e=>console.log(e)))},840:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ErrorController=void 0;const a=t(575),o=t(238),{errorSomeThingWrong:n,errorDuplicate:s,errorCastMongoose:d,errorValidation:i,errorInvalidToken:u,errorTokenExpired:l}=o.MessageLog;r.ErrorController=(e,r,t,o)=>{e.status=e.status||"error",e.statusCode=e.statusCode||500;{let r={...e};return"CastError"===e.name&&(r=(e=>{const r=d(e);return new a.AppErrorHandling(r,400)})(r)),11e3===r.code&&(r=(e=>{const r=e.errmsg.match(/(["'])(?:(?=(\\?))\2.)*?\1/),t=s(r);return new a.AppErrorHandling(t,400)})(r)),"ValidationError"===r.name&&(r=(e=>{const r=Object.values(e.errors).map((e=>e.message)),t=i(r);return new a.AppErrorHandling(t,400)})(r)),"JsonWebTokenError"===r.name&&(r=new a.AppErrorHandling(u,401)),"TokenExpiredError"===r.name&&(r=new a.AppErrorHandling(l,401)),((e,r)=>{e.isOperational?r.status(e.statusCode).json({status:e.status,message:e.message}):(console.error("ERROR ðŸŽ†",e),r.status(500).json({status:"error",message:n}))})(r,t)}}},719:function(e,r,t){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.CategoryModel=void 0;const o=a(t(185)),n=new o.default.Schema({name:{type:String,required:!0},color:{type:String},icon:{type:String},image:{type:String}});n.virtual("id").get((function(){return this._id.toHexString()})),n.set("toJSON",{virtuals:!0}),r.CategoryModel=o.default.model("Category",n)},25:function(e,r,t){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.OrderItemModel=void 0;const o=a(t(185)),n=new o.default.Schema({quantity:{type:Number,required:!0},product:{type:o.default.Schema.Types.ObjectId,ref:"Product"}});n.virtual("id").get((function(){return this._id.toHexString()})),n.set("toJSON",{virtuals:!0}),r.OrderItemModel=o.default.model("OrderItem",n)},417:function(e,r,t){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.OrderModel=void 0;const o=a(t(185)),n=new o.default.Schema({shippingAddress1:{type:String,required:!0},shippingAddress2:{type:String,required:!0},city:{type:String,required:!0},country:{type:String,required:!0},zip:{type:String,required:!0},phone:{type:String,required:!0},status:{type:String,required:!0,default:"Pending"},totalPrice:{type:Number},user:{type:o.default.Schema.Types.ObjectId,ref:"User",required:!0},dateOrdered:{type:Date,default:Date.now},orderItems:[{type:o.default.Schema.Types.ObjectId,ref:"OrderItem",required:!0}]});n.virtual("id").get((function(){return this._id.toHexString()})),n.set("toJSON",{virtuals:!0}),r.OrderModel=o.default.model("Order",n)},500:function(e,r,t){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.ProductModel=void 0;const o=a(t(185)),n=new o.default.Schema({name:{type:String,required:!0},description:{type:String,required:!0},richDescription:{type:String,default:""},image:{type:String,default:""},images:[{type:String}],brand:{type:String,default:""},price:{type:Number,default:0},category:{type:o.default.Schema.Types.ObjectId,ref:"Category",required:!0},countInStock:{type:Number,required:!0,min:0,max:255},rating:{type:Number,default:0},numReviews:{type:Number,default:0},isFeatured:{type:Boolean,default:!1},dateCreated:{type:Date,default:Date.now}});n.virtual("id").get((function(){return this._id.toHexString()})),n.set("toJSON",{virtuals:!0}),r.ProductModel=o.default.model("Product",n)},869:function(e,r,t){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.UserModel=void 0;const o=a(t(185)),n=new o.default.Schema({name:{type:String,required:!0},email:{type:String,required:!0},passwordHash:{type:String,required:!0},street:{type:String,default:""},apartment:{type:String,default:""},city:{type:String,default:""},zip:{type:String,default:""},country:{type:String,required:!0,default:""},phone:{type:Number,required:!0},isAdmin:{type:Boolean,required:!0}});n.virtual("id").get((function(){return this._id.toHexString()})),n.set("toJSON",{virtuals:!0}),r.UserModel=o.default.model("User",n)},390:function(e,r,t){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.CategoryRouter=void 0;const o=a(t(860)),n=t(575),s=t(923),d=t(719);r.CategoryRouter=o.default.Router(),r.CategoryRouter.get("/",(0,s.catchError)((async(e,r,t)=>{const a=await d.CategoryModel.find();if(!a)return t(new n.AppErrorHandling("Not Found Category",500));r.status(200).send(a)}))),r.CategoryRouter.get("/:id",(0,s.catchError)((async(e,r,t)=>{const a=await d.CategoryModel.findById(e.params.id);if(!a)return t(new n.AppErrorHandling("The category with the given ID was not found.",500));r.status(200).send(a)}))),r.CategoryRouter.post("/",(0,s.catchError)((async(e,r,t)=>{const a=new d.CategoryModel({name:e.body.name,icon:e.body.icon,color:e.body.color,image:e.body.image});return a?(await a.save(),r.status(200).json({status:"success",data:a})):t(new n.AppErrorHandling("The category cannot be created",500))}))),r.CategoryRouter.put("/:id",(0,s.catchError)((async(e,r,t)=>{const a=await d.CategoryModel.findByIdAndUpdate(e.params.id,{name:e.body.name,icon:e.body.icon,color:e.body.color},{new:!0});return a?r.status(200).json({status:"success",data:a}):t(new n.AppErrorHandling("The category cannot be updated",500))}))),r.CategoryRouter.delete("/:id",(0,s.catchError)((async(e,r,t)=>await d.CategoryModel.findByIdAndRemove(e.params.id)?r.status(200).json({status:"success",message:"the category is deleted!"}):t(new n.AppErrorHandling("Category not found",500)))))},408:function(e,r,t){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.OrderRouter=void 0;const o=a(t(860)),n=t(575),s=t(923),d=t(417),i=t(25);r.OrderRouter=o.default.Router(),r.OrderRouter.get("/",(0,s.catchError)((async(e,r,t)=>{let a=await d.OrderModel.find().populate("user","name").sort({dateOrdered:-1});if(!a)return t(new n.AppErrorHandling("Not Found listOrder",500));r.status(200).send(a)}))),r.OrderRouter.get("/totalsales",(0,s.catchError)((async(e,r,t)=>{const a=await d.OrderModel.aggregate([{$group:{_id:null,totalsales:{$sum:"$totalPrice"}}}]);if(!a)return t(new n.AppErrorHandling("Not Found total sales",500));r.status(200).send({totalSales:a.pop().totalsales})}))),r.OrderRouter.get("/counts",(0,s.catchError)((async(e,r,t)=>{const a=await d.OrderModel.countDocuments();if(!a)return t(new n.AppErrorHandling("Not Found order count",500));r.status(200).send({orderCount:a})}))),r.OrderRouter.get("/user_order/:userId",(0,s.catchError)((async(e,r,t)=>{let a=await d.OrderModel.find({user:e.params.userId}).populate({path:"orderItems",populate:{path:"product",populate:"category"}}).sort({dateOrdered:-1});if(!a)return t(new n.AppErrorHandling("Not Found order count",500));const o=a?.length??0;r.status(200).send({userOrderList:a,totalCount:o})}))),r.OrderRouter.get("/:id",(0,s.catchError)((async(e,r,t)=>{let a=await d.OrderModel.findById(e.params.id);if(a=await a.populate("user","name"),a=await a.populate({path:"orderItems",populate:{path:"product",populate:"category"}}),!a)return t(new n.AppErrorHandling("Not Found listOrder",500));r.status(200).send(a)}))),r.OrderRouter.post("/",(0,s.catchError)((async(e,r,t)=>{const{orderItems:a,shippingAddress1:o,shippingAddress2:s,city:u,country:l,zip:c,phone:p,status:g,user:y}=e.body,m=await Promise.all(a.map((async e=>{const r=e,t=new i.OrderItemModel({product:r.product,quantity:r.quantity});return await t.save(),t._id}))),f=(await Promise.all(m.map((async e=>{let r=await i.OrderItemModel.findById(e);r=await r.populate("product","price");return r.product.price*r.quantity})))).reduce(((e,r)=>e+r),0),h=new d.OrderModel({orderItems:m,shippingAddress1:o,shippingAddress2:s,city:u,country:l,zip:c,phone:p,status:g,totalPrice:f,user:y});return await h.save(),h?r.status(200).json({status:"success",data:h}):t(new n.AppErrorHandling("The order cannot be created",500))}))),r.OrderRouter.put("/:id",(0,s.catchError)((async(e,r,t)=>{const a=await d.OrderModel.findByIdAndUpdate(e.params.id,{status:e.body.status},{new:!0});return a?r.status(200).json({status:"success",data:a}):t(new n.AppErrorHandling("The status order cannot be updated",500))}))),r.OrderRouter.delete("/:id",(0,s.catchError)((async(e,r,t)=>{const a=await d.OrderModel.findByIdAndRemove(e.params.id);return a?(await Promise.all(a.orderItems.map((async e=>{console.log({orderItem:e}),await i.OrderItemModel.findByIdAndRemove(e)}))),r.status(200).json({status:"success",message:"the order is deleted!"})):t(new n.AppErrorHandling("Order not found",500))})))},684:function(e,r,t){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.ProductRouter=void 0;const o=a(t(860)),n=t(575),s=t(923),d=t(500),i=t(719),u=a(t(738)),l=a(t(185));r.ProductRouter=o.default.Router();const c={"image/png":"png","image/jpeg":"jpeg","image/jpg":"jpg"},p=u.default.diskStorage({destination:function(e,r,t){const a=c[r.mimetype];let o=new Error("Invalid image type");a&&(o=null);t(o,"public/uploads")},filename:function(e,r,t){const a=c[r.mimetype];t(null,`${r.originalname.split(" ").join("-")}-${Date.now()}.${a}`)}}),g=(0,u.default)({storage:p});r.ProductRouter.get("/",(0,s.catchError)((async(e,r,t)=>{let a={};e.query.categories&&(a={category:e.query.categories.split(",")});let o=await d.ProductModel.find(a).populate("category");if(!o)return t(new n.AppErrorHandling("Not Found ProductList",500));r.status(200).send(o)}))),r.ProductRouter.get("/counts",(0,s.catchError)((async(e,r,t)=>{const a=await d.ProductModel.countDocuments();if(!a)return t(new n.AppErrorHandling("Not Found Product Count",500));r.status(200).send({productCount:a})}))),r.ProductRouter.get("/featured",(0,s.catchError)((async(e,r,t)=>{const a=await d.ProductModel.find({isFeatured:!0});if(!a)return t(new n.AppErrorHandling("Not Found Product isFeatured",500));r.status(200).send({product:a})}))),r.ProductRouter.get("/featured/:count",(0,s.catchError)((async(e,r,t)=>{const a=Number(e.params.count)??0,o=await d.ProductModel.find({isFeatured:!0}).limit(a);if(!o)return t(new n.AppErrorHandling("Not Found Product isFeatured",500));r.status(200).send({product:o})}))),r.ProductRouter.get("/:id",(0,s.catchError)((async(e,r,t)=>{let a=await d.ProductModel.findById(e.params.id);if(!a)return t(new n.AppErrorHandling("Not Found ProductList",500));a=await a.populate("category"),r.status(200).send(a)}))),r.ProductRouter.post("/",g.single("image"),(0,s.catchError)((async(e,r,t)=>{if(!await i.CategoryModel.findById(e.body.category))return t(new n.AppErrorHandling("Invalid Category",400));if(!e.file)return t(new n.AppErrorHandling("No image in the request",400));const a=e.file.filename,o=`${e.protocol}://${e.get("host")}/static/uploads`,s=new d.ProductModel({name:e.body.name,description:e.body.description,richDescription:e.body.richDescription,image:`${o}/${a}`,brand:e.body.brand,price:e.body.price,category:e.body.category,countInStock:e.body.countInStock,rating:e.body.rating,numReviews:e.body.numReviews,isFeatured:e.body.isFeatured});return await s.save(),s?r.status(200).json({status:"success",data:s}):t(new n.AppErrorHandling("The prodcut cannot be created",500))}))),r.ProductRouter.post("/gallery_images/:id",g.array("images",10),(0,s.catchError)((async(e,r,t)=>{if(!l.default.isValidObjectId(e.params.id))return t(new n.AppErrorHandling("Invalid Product Id",400));const a=e.files,o=[],s=`${e.protocol}://${e.get("host")}/static/uploads/`;Array.isArray(a)&&a.forEach((e=>o.push(`${s}${e.filename}`)));const i=await d.ProductModel.findByIdAndUpdate(e.params.id,{images:o},{new:!0});return i?r.status(200).json({status:"success",product:i}):t(new n.AppErrorHandling("The product cannot be update!",500))}))),r.ProductRouter.put("/:id",g.single("image"),(0,s.catchError)((async(e,r,t)=>{if(!l.default.isValidObjectId(e.params.id))return t(new n.AppErrorHandling("Invalid Product Id",400));if(!await i.CategoryModel.findById(e.body.category))return t(new n.AppErrorHandling("Invalid Category",400));const a=await d.ProductModel.findById(e.params.id);if(!a)return t(new n.AppErrorHandling("Invalid Product",400));const o=e.file;let s=a.image;if(o){const r=e.file.filename;s=`${`${e.protocol}://${e.get("host")}/static/uploads/`}${r}`}const u=await d.ProductModel.findByIdAndUpdate(e.params.id,{name:e.body.name,description:e.body.description,richDescription:e.body.richDescription,image:s,brand:e.body.brand,price:e.body.price,category:e.body.category,countInStock:e.body.countInStock,rating:e.body.rating,numReviews:e.body.numReviews,isFeatured:e.body.isFeatured},{new:!0});return u?r.status(200).json({status:"success",data:u}):t(new n.AppErrorHandling("The Product cannot be updated",500))}))),r.ProductRouter.delete("/:id",(0,s.catchError)((async(e,r,t)=>await d.ProductModel.findByIdAndRemove(e.params.id)?r.status(200).json({status:"success",message:"The product is deleted!"}):t(new n.AppErrorHandling("Product not found",500)))))},517:function(e,r,t){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.UserRouter=void 0;const o=a(t(860)),n=t(575),s=t(923),d=t(869),i=a(t(344)),u=a(t(96));r.UserRouter=o.default.Router(),r.UserRouter.get("/",(0,s.catchError)((async(e,r,t)=>{const a=await d.UserModel.find().select("-passwordHash");if(!a)return t(new n.AppErrorHandling("Not Found userList",500));r.status(200).send(a)}))),r.UserRouter.get("/counts",(0,s.catchError)((async(e,r,t)=>{const a=await d.UserModel.countDocuments();if(console.log({userCount:a}),!a)return t(new n.AppErrorHandling("Not Found User Count",500));r.status(200).send({userCount:a})}))),r.UserRouter.get("/:id",(0,s.catchError)((async(e,r,t)=>{const a=await d.UserModel.findById(e.params.id).select("-passwordHash");if(!a)return t(new n.AppErrorHandling("Not Found userList",500));r.status(200).send(a)}))),r.UserRouter.post("/register",(0,s.catchError)((async(e,r,t)=>{const{name:a,email:o,apartment:s,city:i,country:l,isAdmin:c,passwordHash:p,phone:g,street:y,zip:m}=e.body,f=u.default.hashSync(p,10),h=new d.UserModel({name:a,email:o,apartment:s,city:i,country:l,isAdmin:c,passwordHash:f,phone:g,street:y,zip:m});return h?(await h.save(),r.status(200).json({status:"success",data:h})):t(new n.AppErrorHandling("The prodcut cannot be created",500))}))),r.UserRouter.post("/login",(0,s.catchError)((async(e,r,t)=>{const{email:a,passwordHash:o,id:s,isAdmin:l}=e.body,c=await d.UserModel.findOne({email:a});if(!c)return t(new n.AppErrorHandling("The User not found",400));if(c&&o&&u.default.compareSync(o,c.passwordHash)){console.log("hoangquydat",{id:s,isAdmin:l});const e=i.default.sign({userId:c.id,isAdmin:c.isAdmin},"hoangquydat",{expiresIn:"1d"});return r.status(200).send({user:a,token:e})}return r.status(200).send("Password is wrong")}))),r.UserRouter.delete("/:id",(0,s.catchError)((async(e,r,t)=>await d.UserModel.findByIdAndRemove(e.params.id)?r.status(200).json({status:"success",message:"The user is deleted!"}):t(new n.AppErrorHandling("User not found",500)))))},575:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.AppErrorHandling=void 0;class t extends Error{statusCode;status;isOperational;constructor(e,r){super(e),this.statusCode=r,this.status=`${r}`.startsWith("4")?"fail":"error",this.isOperational=!0,Error.captureStackTrace(this,this.constructor)}}r.AppErrorHandling=t},42:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.catchError=void 0;r.catchError=e=>(r,t,a)=>{e(r,t,a).catch((e=>a(e)))}},790:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.isImage=r.filterObj=void 0;r.filterObj=(e,...r)=>{const t={};return Object.keys(e).forEach((a=>{r.includes(a)&&(t[a]=e[a])})),t};r.isImage=e=>/\.(jpg|jpeg|png|webp|avif|gif|svg)$/.test(e)},608:function(e,r,t){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.sendEmail=void 0;const o=a(t(184));r.sendEmail=async e=>{const r=o.default.createTransport({host:process.env.EMAIL_HOST,port:+process.env.EMAIL_PORT,auth:{user:process.env.EMAIL_USERNAME,pass:process.env.EMAIL_PASSWORD}}),t={from:"<Food@gmail.com>",to:e.email,subject:e.subject,text:e.message};await r.sendMail(t)}},238:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.MessageLog=void 0;r.MessageLog={errorSignUp:"Can't SignUp User",errorProvideEmailOrPassword:"Please provide email and password!",errorIncorrectPassword:"Incorrect email or password",errorNotHaveToken:"You are not logged in! Please log in to get access",errorCreateUser:"Can't Create User",errorSomeThingWrong:"Something went very wrong!",errorInvalidToken:"Invalid token. Please log in again!",errorTokenExpired:"Your token has expired! PLease login agian!",errorTokenNoLongerExist:"The user belonging to this token does no longer exist",errorTokenChangedPassword:"User recently changed password! Please log in again.",errorNotHavePermission:"You do not have permission to perform this action",errorNoUserWithUserName:"There is no user with email address",errorSendingEmail:"There was error sending the email. Try again later!",errorTokenInvalidOrHasExpired:" Token is invalid or has expired",messageSubjectEmailResetPassword:"Your password reset token valid for 10 min",messageTokenSentToEmail:"Token sent to email!",errorFetchUsers:"Can't fetch data user or delete the previous. Please try again later!",errorWrongRouteUpdate:"This route is not for password updates. Please use /updatepassword",errorFetchMenu:"Can't fetch data menu or delete the previous. Please try again later!",errorDeleteUser:"Can't delete user. Please try again later!",errorDeleteMenu:"Can't delete menu. Please try again later!",errorInvalidImage:"Invalid image. Please add right format!",errorCreateMenu:"Can't Create Menu",errorUpdateMenuById:"Can't update menu by id. Please try again later!",errorCreateRestaurant:"Can't Create Restaurant",errorDeleteRestaurant:"Can't delete Restaurant. Please try again later!",errorUpdateRestaurantById:"Can't update Restaurant by id. Please try again later!",errorFetchRestaurant:"Can't fetch data Restaurant or delete the previous. Please try again later!",errorCreateCategory:"Can't Create Category",errorDeleteCategory:"Can't delete Category. Please try again later!",errorUpdateCategoryById:"Can't update Category by id. Please try again later!",errorFetchCategory:"Can't fetch data Category or delete the previous. Please try again later!",errorCreateState:"Can't Create State",errorDeleteState:"Can't delete State. Please try again later!",errorUpdateStateById:"Can't update State by id. Please try again later!",errorFetchState:"Can't fetch data State or delete the previous. Please try again later!",errorCreateCity:"Can't Create City",errorDeleteCity:"Can't delete City. Please try again later!",errorUpdateCityById:"Can't update City by id. Please try again later!",errorFetchCity:"Can't fetch data City or delete the previous. Please try again later!",errorCreatePromo:"Can't Create Promo",errorDeletePromo:"Can't delete Promo. Please try again later!",errorUpdatePromoById:"Can't update Promo by id. Please try again later!",errorFetchPromo:"Can't fetch data Promo or delete the previous. Please try again later!",errorCreateStatus:"Can't Create Status",errorDeleteStatus:"Can't delete Status. Please try again later!",errorUpdateStatusById:"Can't update Status by id. Please try again later!",errorFetchStatus:"Can't fetch data Status or delete the previous. Please try again later!",errorRequestManyTime:"Too many requests from this IP,  please try again in an hour",errorUpdateProfile:"Can't update profile",errorUpdateUser:"Can't update user",errorNotRightImage:"Not an image! Please upload only images",errorCreateSubMenu:"Can't Create SubMenu",errorDeleteSubMenu:"Can't delete submenu. Please try again later!",errorUpdateSubMenuById:"Can't update submenu by id. Please try again later!",errorFetchSubMenu:"Can't fetch data submenu or delete the previous. Please try again later!",errorCreateReview:"Can't Create Review",errorDeleteReview:"Can't delete Review. Please try again later!",errorUpdateReviewById:"Can't update Review by id. Please try again later!",errorFetchReview:"Can't fetch data Review or delete the previous. Please try again later!",errorCreateOrder:"Can't Create Order",errorDeleteOrder:"Can't delete order. Please try again later!",errorUpdateOrderById:"Can't update order by id. Please try again later!",errorFetchOrder:"Can't fetch data order or delete the previous. Please try again later!",errorCreateOrderDetail:"Can't Create Order Detail",errorDeleteOrderDetail:"Can't delete order Detail. Please try again later!",errorUpdateOrderDetailById:"Can't update order Detail by id. Please try again later!",errorFetchOrderDetail:"Can't fetch data order Detail or delete the previous. Please try again later!",errorCreateMenuDetail:"Can't Create Menu Detail",errorDeleteMenuDetail:"Can't delete menu detail. Please try again later!",errorUpdateMenuDetailById:"Can't update menu detail by id. Please try again later!",errorFetchMenuDetail:"Can't fetch data menu detail or delete the previous. Please try again later!",errorCreateMenuPromo:"Can't Create Menu Promo",errorDeleteMenuPromo:"Can't delete menu promo. Please try again later!",errorUpdateMenuPromoById:"Can't update menu promo by id. Please try again later!",errorFetchMenuPromo:"Can't fetch data menu promo or delete the previous. Please try again later!",errorDuplicate:e=>`Duplicate field value: ${e}. The User has been signup. PLease try use another phone or email`,errorCastMongoose:e=>`Invalid ${e.path}: ${e.value}`,errorValidation:e=>`Invalid input data. ${e.join(". ")} `,messageForgotPassword:e=>`Forgot your password? Submit a PATCH request with your new password and passwordConfirm to: ${e}.\n If you didn't forget your password, please ignore this email!`}},383:function(e,r,t){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.authJwt=r.createSendToken=r.compareToken=r.signToken=void 0;const o=a(t(344)),n=a(t(159)),s=t(779);r.signToken=e=>o.default.sign(e,process.env.JWT_SECRET,{expiresIn:process.env.JWT_EXPIRES_IN});r.compareToken=e=>o.default.verify(e,process.env.JWT_SECRET);r.createSendToken=(e,t,a)=>{const o=(0,r.signToken)((0,n.default)(e,["user_name","type_login","_id"])),s={expires:new Date(Date.now()+24*Number(process.env.JWT_COOKIE_EXPIRES_IN)*60*60*1e3),httpOnly:!0,secure:!0};return a.cookie("jwt",o,s),e.user_password=void 0,a.status(t).json({status:"Success",token:o,data:e})};const d=(e,r)=>"string"==typeof r.payload||!r.payload.isAdmin;r.authJwt=()=>(0,s.expressjwt)({secret:"hoangquydat",algorithms:["HS256"],isRevoked:d}).unless({path:[{url:/\/api\/v1\/products(.*)/,methods:["GET","OPTIONS"]},{url:/\/api\/v1\/categories(.*)/,methods:["GET","OPTIONS"]},{url:/\/static\/(.*)/,methods:["GET","OPTIONS"]},"/api/v1/users/login","/api/v1/users/register"]})},597:function(e,r,t){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.uploadImage=void 0;const o=a(t(738)),n=t(923),{errorNotRightImage:s}=n.MessageLog,d=o.default.memoryStorage();r.uploadImage=(0,o.default)({storage:d,fileFilter:(e,r,t)=>{r.mimetype.startsWith("image")?t(null,!0):t(new n.AppErrorHandling(s,400),!1)}})},923:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.uploadImage=r.isImage=r.filterObj=r.sendEmail=r.createSendToken=r.MessageLog=r.signToken=r.compareToken=r.catchError=r.AppErrorHandling=void 0;const a=t(575);Object.defineProperty(r,"AppErrorHandling",{enumerable:!0,get:function(){return a.AppErrorHandling}});const o=t(42);Object.defineProperty(r,"catchError",{enumerable:!0,get:function(){return o.catchError}});const n=t(383);Object.defineProperty(r,"compareToken",{enumerable:!0,get:function(){return n.compareToken}}),Object.defineProperty(r,"signToken",{enumerable:!0,get:function(){return n.signToken}}),Object.defineProperty(r,"createSendToken",{enumerable:!0,get:function(){return n.createSendToken}});const s=t(238);Object.defineProperty(r,"MessageLog",{enumerable:!0,get:function(){return s.MessageLog}});const d=t(608);Object.defineProperty(r,"sendEmail",{enumerable:!0,get:function(){return d.sendEmail}});const i=t(790);Object.defineProperty(r,"filterObj",{enumerable:!0,get:function(){return i.filterObj}}),Object.defineProperty(r,"isImage",{enumerable:!0,get:function(){return i.isImage}});const u=t(597);Object.defineProperty(r,"uploadImage",{enumerable:!0,get:function(){return u.uploadImage}})},654:function(e,r,t){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});const o=a(t(860)),n=(a(t(470)),a(t(985))),s=a(t(806)),d=a(t(821)),i=a(t(396)),u=a(t(487)),l=a(t(710)),c=a(t(582)),p=t(840),g=t(390),y=t(408),m=t(684),f=t(517),h=t(238),w=t(383),{errorRequestManyTime:v}=h.MessageLog,P=(0,o.default)(),C=(0,n.default)({max:100,windowMs:36e5,message:v});P.use((0,c.default)()),P.options("*",(0,c.default)()),P.use((0,s.default)()),P.use("/api",C),P.use((0,w.authJwt)()),P.use(o.default.json({limit:"10kb"})),P.use(o.default.urlencoded({extended:!0,limit:"10kb"})),P.use("/static",o.default.static("public")),P.use((0,l.default)()),P.use((0,d.default)()),P.use((0,i.default)()),P.use((0,u.default)({whitelist:[]})),P.use("/api/v1/categories",g.CategoryRouter),P.use("/api/v1/products",m.ProductRouter),P.use("/api/v1/users",f.UserRouter),P.use("/api/v1/orders",y.OrderRouter),P.use(p.ErrorController),P.all("*",((e,r,t)=>{r.status(404).json("Error 404")})),r.default=P},341:function(e,r,t){var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});const o=a(t(685)),n=a(t(654));t(827);const s=o.default.createServer(n.default),d=process.env.PORT||3e3;s.listen(d,(()=>{console.log("Server running on:"+d)}))},96:e=>{e.exports=require("bcrypt")},710:e=>{e.exports=require("cookie-parser")},582:e=>{e.exports=require("cors")},860:e=>{e.exports=require("express")},779:e=>{e.exports=require("express-jwt")},821:e=>{e.exports=require("express-mongo-sanitize")},985:e=>{e.exports=require("express-rate-limit")},806:e=>{e.exports=require("helmet")},487:e=>{e.exports=require("hpp")},344:e=>{e.exports=require("jsonwebtoken")},159:e=>{e.exports=require("lodash/pick")},185:e=>{e.exports=require("mongoose")},470:e=>{e.exports=require("morgan")},738:e=>{e.exports=require("multer")},184:e=>{e.exports=require("nodemailer")},396:e=>{e.exports=require("xss-clean")},685:e=>{e.exports=require("http")}},r={};(function t(a){var o=r[a];if(void 0!==o)return o.exports;var n=r[a]={exports:{}};return e[a].call(n.exports,n,n.exports,t),n.exports})(341)})();
//# sourceMappingURL=index.js.map